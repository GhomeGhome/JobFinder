<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/TEMPLATES/employerTemplate.xhtml">
    <ui:define name="title">Employer Profile ‚Äì JobFinder</ui:define>

    <ui:define name="content">
        <div class="page-header">
            <h1>Employer Profile</h1>
            <p class="page-subtitle">Manage your account and company details.</p>
        </div>

        <div style="display: flex; gap: 32px; align-items: start; flex-wrap: wrap;">

            <div class="card" style="text-align: center; width: 250px; flex-shrink: 0;">
                <img src="#{profileViewBean.getAvatarUrl(loginBean.loggedEmployer)}"
                     alt="Avatar"
                     style="width: 120px; height: 120px; border-radius: 12px; object-fit: cover; margin-bottom: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);" />

                <div style="margin-bottom: 16px;">
                    <span class="status-badge" style="background-color: #e0e7ff; color: #4338ca;">Employer</span>
                </div>

                <div class="field" style="text-align: left; margin-bottom: 16px;">
                    <label class="field-label" style="font-size: 12px;">Choose an Avatar</label>

                    <input type="hidden" name="hiddenAvatarUrl" id="hiddenAvatarUrl" value="#{loginBean.loggedEmployer.photoUrl}" />

                    <script>
                        function selectAvatar(url) {
                            document.getElementById("hiddenAvatarUrl").value = url; // Standard JS

                            // Update the visual image
                            var bigImg = document.querySelector(".card img[alt='Avatar']");
                            if(bigImg) bigImg.src = url;
                        }
                    </script>

                    <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; justify-content: center;">

                        <img src="https://avataaars.io/?avatarStyle=Circle&amp;topType=ShortHairShortFlat&amp;accessoriesType=Sunglasses&amp;hairColor=Black&amp;facialHairType=Blank&amp;clotheType=Hoodie&amp;clotheColor=Red&amp;eyeType=Happy&amp;eyebrowType=Default&amp;mouthType=Smile&amp;skinColor=Light"
                             onclick="selectAvatar(this.src)" title="Option 1"
                             style="width: 45px; height: 45px; cursor: pointer; border-radius: 50%; transition: transform 0.2s;"
                             onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />

                        <img src="https://avataaars.io/?avatarStyle=Circle&amp;topType=LongHairStraight&amp;accessoriesType=Blank&amp;hairColor=BrownDark&amp;facialHairType=Blank&amp;clotheType=BlazerShirt&amp;eyeType=Default&amp;eyebrowType=Default&amp;mouthType=Default&amp;skinColor=Light"
                             onclick="selectAvatar(this.src)" title="Option 2"
                             style="width: 45px; height: 45px; cursor: pointer; border-radius: 50%; transition: transform 0.2s;"
                             onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />

                        <img src="https://avataaars.io/?avatarStyle=Circle&amp;topType=ShortHairDreads01&amp;accessoriesType=Blank&amp;hairColor=Black&amp;facialHairType=BeardLight&amp;clotheType=BlazerSweater&amp;eyeType=Happy&amp;eyebrowType=Default&amp;mouthType=Smile&amp;skinColor=Brown"
                             onclick="selectAvatar(this.src)" title="Option 3"
                             style="width: 45px; height: 45px; cursor: pointer; border-radius: 50%; transition: transform 0.2s;"
                             onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />

                        <img src="https://avataaars.io/?avatarStyle=Circle&amp;topType=NoHair&amp;accessoriesType=Prescription02&amp;hairColor=Black&amp;facialHairType=MoustacheMagnum&amp;clotheType=BlazerShirt&amp;eyeType=Default&amp;eyebrowType=Default&amp;mouthType=Default&amp;skinColor=Light"
                             onclick="selectAvatar(this.src)" title="Option 4"
                             style="width: 45px; height: 45px; cursor: pointer; border-radius: 50%; transition: transform 0.2s;"
                             onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'" />
                    </div>

                    <script>
                        function selectAvatar(url) {
                            var input = document.querySelector("input[type='hidden'][id$='avatarUrlInput']");
                            if(input) input.value = url;

                            var bigImg = document.querySelector(".card img[alt='Avatar']");
                            if(bigImg) bigImg.src = url;
                        }
                    </script>
                </div>

                <h:link outcome="/employerProfileView.xhtml" styleClass="btn btn-light btn-full">
                    <f:param name="id" value="#{loginBean.loggedEmployer.id}" />
                    üëÅÔ∏è View Public Profile
                </h:link>
            </div>

            <div class="card" style="flex-grow: 1; min-width: 300px;">
                <h:form>
                    <h:messages globalOnly="true"
                                style="list-style:none; padding:0; margin-bottom:16px;"
                                infoStyle="color: #15803d; background-color: #dcfce7; padding: 10px; border-radius: 6px; border: 1px solid #bbf7d0; display: block;"
                                errorStyle="color: #b91c1c; background-color: #fee2e2; padding: 10px; border-radius: 6px; border: 1px solid #fecaca; display: block;" />

                    <h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                        Personal Information
                    </h3>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="field">
                            <span class="field-label">First Name</span>
                            <h:inputText value="#{loginBean.loggedEmployer.firstName}" styleClass="input-full" required="true" />
                        </div>
                        <div class="field">
                            <span class="field-label">Last Name</span>
                            <h:inputText value="#{loginBean.loggedEmployer.lastName}" styleClass="input-full" required="true" />
                        </div>
                    </div>

                    <div class="field">
                        <span class="field-label">About Me (Your Role)</span>
                        <h:inputTextarea value="#{loginBean.loggedEmployer.descriptionInfo}"
                                         styleClass="input-full"
                                         rows="3"
                                         placeholder="Briefly describe your role (e.g. Hiring Manager at...)" />
                    </div>

                    <h3 style="margin-top: 24px; margin-bottom: 16px; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 8px;">
                        Company Details
                    </h3>

                    <div class="field">
                        <span class="field-label">Location (City)</span>
                        <h:inputText value="#{loginBean.loggedCompany.location}" styleClass="input-full" />
                    </div>

                    <div class="field">
                        <span class="field-label">About the Company (Description)</span>
                        <h:inputTextarea value="#{loginBean.loggedCompany.description}"
                                         styleClass="input-full"
                                         rows="4" />
                    </div>

                    <h3 style="margin-top: 24px; margin-bottom: 8px;">Link to a company</h3>
                    <p style="color:#6b7280; margin-top:0;">Search an existing company and link your employer account to it.</p>
                    <h:form>
                        <div class="field">
                            <span class="field-label">Search by name</span>
                            <h:inputText value="#{companySearchQuery}" styleClass="input-full" id="companySearchInput">
                                <f:ajax event="keyup" render="companyResults" />
                            </h:inputText>
                        </div>

                        <h:panelGroup id="companyResults">
                            <ui:fragment rendered="#{not empty companyBean.searchByName(companySearchQuery)}">
                                <ul class="suggestions-list" style="background:white; border:1px solid #ddd; list-style:none; padding:0;">
                                    <ui:repeat value="#{companyBean.searchByName(companySearchQuery)}" var="c">
                                        <li style="padding:8px; border-bottom:1px solid #eee; display:flex; justify-content:space-between;">
                                            #{c.name} ¬∑ #{c.location}
                                            <h:commandLink value="Link" action="#{companyBean.linkEmployerToCompany(c.id)}" style="color:#2563eb; font-weight:bold;">
                                                <f:ajax render="@form" />
                                            </h:commandLink>
                                        </li>
                                    </ui:repeat>
                                </ul>
                            </ui:fragment>
                        </h:panelGroup>
                    </h:form>

                    <h3 style="margin-top: 24px; margin-bottom: 16px; font-size: 18px; border-bottom: 1px solid #eee; padding-bottom: 8px; color: #dc2626;">
                        Account Security
                    </h3>

                    <div class="field">
                        <span class="field-label">Email Address</span>
                        <h:inputText value="#{loginBean.loggedEmployer.email}"
                                     styleClass="input-full"
                                     readonly="true"
                                     style="background-color: #f3f4f6; color: #6b7280;" />
                    </div>

                    <div class="field">
                        <span class="field-label">New Password</span>
                        <h:inputSecret value="#{loginBean.loggedEmployer.password}" styleClass="input-full" redisplay="true" />
                    </div>

                    <div style="margin-top: 32px;">
                        <h:commandButton value="Save Changes"
                                         action="#{userBean.updateProfile}"
                                         styleClass="btn btn-primary btn-full" />
                    </div>
                </h:form>
            </div>
        </div>
    </ui:define>
</ui:composition>