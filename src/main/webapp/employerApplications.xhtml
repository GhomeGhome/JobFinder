<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/TEMPLATES/employerTemplate.xhtml">

    <ui:define name="title">
        Applications â€“ JobFinder
    </ui:define>

    <ui:define name="content">

        <div class="page-header">
            <h1>
                <!-- When coming from "View applicants" -->
                <h:panelGroup rendered="#{applicationBean.filteredByJob}">
                    Applications for:
                    #{applicationBean.getJobTitle(applicationBean.filterJobOfferId)}
                </h:panelGroup>

                <!-- When coming from the top nav -->
                <h:panelGroup rendered="#{not applicationBean.filteredByJob}">
                    All applications
                </h:panelGroup>
            </h1>

            <p class="page-subtitle">
                <h:panelGroup rendered="#{applicationBean.filteredByJob}">
                    Only candidates who applied to this specific job post.
                </h:panelGroup>
                <h:panelGroup rendered="#{not applicationBean.filteredByJob}">
                    Review all candidates who applied to your job posts.
                </h:panelGroup>
            </p>

            <!-- Buttons under the subtitle -->
            <div style="margin-top: 8px; display:flex; gap:8px; flex-wrap:wrap;">
<!--                &lt;!&ndash; Back to job posts &ndash;&gt;-->
<!--                <h:link outcome="/employerDashboard.xhtml"-->
<!--                        value="Back to job posts"-->
<!--                        styleClass="btn btn-light" />-->

                <!-- Clear job filter (only shown when filtered) -->
                <h:form rendered="#{applicationBean.filteredByJob}">
                    <h:commandButton value="Show all applications"
                                     action="#{applicationBean.clearJobFilter}"
                                     styleClass="btn btn-light" />
                </h:form>
            </div>
        </div>

        <h:form>
            <h:dataTable value="#{applicationBean.applicationsForLoggedEmployer}"
                         var="a"
                         styleClass="job-table">

            <h:column>
                    <f:facet name="header">Job offer</f:facet>
                    <h:link outcome="/applicantJobDetails.xhtml"
                            style="font-weight: bold; color: #2563eb; text-decoration: underline;">
                        #{applicationBean.getJobTitle(a.jobOfferId)}
                        <f:param name="jobId" value="#{a.jobOfferId}" />
                    </h:link>
                </h:column>

                <h:column>
                    <f:facet name="header">Candidate</f:facet>
                    <h:link outcome="applicantProfileView.xhtml"
                            value="#{applicationBean.getApplicantName(a.applicantId)}"
                            style="font-weight: bold; color: #2563eb; text-decoration: underline;">
                        <f:param name="id" value="#{a.applicantId}" />
                    </h:link>
                </h:column>

                <h:column>
                    <f:facet name="header">Status</f:facet>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <h:selectOneMenu value="#{a.status}"
                                         style="padding: 6px; border-radius: 4px; border: 1px solid #ccc;">
                            <!-- Only allow employer-actions (In Review / Accepted / Rejected) -->
                            <f:selectItems value="#{applicationBean.allStatuses}"
                                           var="st"
                                           itemValue="#{st}"
                                           itemLabel="#{applicationBean.labelFor(st)}" />
                            <f:ajax execute="@this" />
                        </h:selectOneMenu>
                        <h:commandButton value="Update"
                                         action="#{applicationBean.updateStatus(a)}"
                                         style="background-color: #2563eb; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;" />
                    </div>
                </h:column>

                <h:column>
                    <f:facet name="header">Match score</f:facet>

                    <h:panelGroup rendered="#{not empty a.matchScore}">
                        <h:outputText value="#{a.matchScore}">
                            <f:convertNumber maxFractionDigits="1" minFractionDigits="1" />
                        </h:outputText>
                        %
                    </h:panelGroup>

                    <h:panelGroup rendered="#{empty a.matchScore}">
                        N/A
                    </h:panelGroup>
                </h:column>


                <h:column>
                    <f:facet name="header">Date</f:facet>
                    #{a.dateApplied}
                </h:column>

                <h:column>
                    <f:facet name="header">Action</f:facet>

                    <h:panelGroup rendered="#{a.status.name() eq 'Accepted'}">
                        <h:link outcome="employerInterviews.xhtml"
                                value="ðŸ“… Schedule Interview"
                                styleClass="btn-small"
                                style="background-color: #15803d; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px;">
                            <f:param name="candidateName" value="#{applicationBean.getApplicantName(a.applicantId)}" />
                        </h:link>
                    </h:panelGroup>
                </h:column>

                <h:column>
                    <f:facet name="header">Action</f:facet>

                    <h:panelGroup rendered="#{a.status.name() eq 'Accepted'}">

                        <h:link outcome="employerInterviews.xhtml"
                                style="display: inline-block; background-color: #15803d; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 12px; font-weight: bold;">

                            ðŸ“… Schedule Interview

                            <f:param name="candidateName" value="#{applicationBean.getApplicantName(a.applicantId)}" />
                        </h:link>

                    </h:panelGroup>

                    <h:panelGroup rendered="#{a.status != 'Accepted'}">
                        <span style="color: #9ca3af; font-size: 12px; font-style: italic;">No actions yet</span>
                    </h:panelGroup>
                </h:column>

            </h:dataTable>
        </h:form>

    </ui:define>

</ui:composition>
