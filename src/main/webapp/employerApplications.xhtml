<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/TEMPLATES/employerTemplate.xhtml">

    <ui:define name="title">
        Applications ‚Äì JobFinder
    </ui:define>

    <ui:define name="content">

        <div class="page-header">
            <h1>
                <!-- When coming from "View applicants" -->
                <h:panelGroup rendered="#{applicationBean.filteredByJob}">
                    Applications for:
                    #{applicationBean.getJobTitle(applicationBean.filterJobOfferId)}
                </h:panelGroup>

                <!-- When coming from the top nav -->
                <h:panelGroup rendered="#{not applicationBean.filteredByJob}">
                    All applications
                </h:panelGroup>
            </h1>

            <p class="page-subtitle">
                <h:panelGroup rendered="#{applicationBean.filteredByJob}">
                    Only candidates who applied to this specific job post.
                </h:panelGroup>
                <h:panelGroup rendered="#{not applicationBean.filteredByJob}">
                    Review all candidates who applied to your job posts.
                </h:panelGroup>
            </p>

            <!-- Buttons under the subtitle -->
            <div style="margin-top: 8px; display:flex; gap:8px; flex-wrap:wrap;">
<!--                &lt;!&ndash; Back to job posts &ndash;&gt;-->
<!--                <h:link outcome="/employerDashboard.xhtml"-->
<!--                        value="Back to job posts"-->
<!--                        styleClass="btn btn-light" />-->

                <!-- Clear job filter (only shown when filtered) -->
                <h:form rendered="#{applicationBean.filteredByJob}">
                    <h:commandButton value="Show all applications"
                                     action="#{applicationBean.clearJobFilter}"
                                     styleClass="btn btn-light" />
                </h:form>
            </div>
        </div>

        <h:form>
            <h:dataTable value="#{applicationBean.applicationsForLoggedEmployer}"
                         var="a"
                         styleClass="job-table">

            <h:column>
                    <f:facet name="header">Job offer</f:facet>
                    <h:link outcome="/applicantJobDetails.xhtml"
                            style="display: inline-block; font-weight: 600; color: #1e293b; text-decoration: none; padding: 6px 12px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 8px; border: 1px solid #e2e8f0; transition: all 0.2s ease; font-size: 13px;">
                        #{applicationBean.getJobTitle(a.jobOfferId)}
                        <f:param name="jobId" value="#{a.jobOfferId}" />
                    </h:link>
                </h:column>

                <h:column>
                    <f:facet name="header">Candidate</f:facet>
                    <h:link outcome="applicantProfileView.xhtml"
                            style="display: inline-flex; align-items: center; gap: 8px; font-weight: 600; color: #1e293b; text-decoration: none; padding: 6px 12px; background: white; border-radius: 8px; border: 1px solid #e2e8f0; transition: all 0.2s ease; font-size: 13px; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                        <span style="width: 28px; height: 28px; background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700;">#{applicationBean.getApplicantName(a.applicantId).substring(0,1)}</span>
                        #{applicationBean.getApplicantName(a.applicantId)}
                        <f:param name="id" value="#{a.applicantId}" />
                    </h:link>
                </h:column>

                <h:column>
                    <f:facet name="header">Status</f:facet>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <h:selectOneMenu value="#{applicationBean.selectedStatuses[a.id]}"
                                         style="padding: 6px; border-radius: 4px; border: 1px solid #ccc;">
                            <!-- Only allow employer-actions (In Review / Accepted / Rejected) -->
                            <f:selectItems value="#{applicationBean.employerStatuses}"
                                           var="st"
                                           itemValue="#{st.name()}"
                                           itemLabel="#{applicationBean.labelFor(st)}" />
                            <f:ajax execute="@this" />
                        </h:selectOneMenu>
                        <h:commandButton value="Update"
                                         action="#{applicationBean.updateStatus(a)}"
                                         style="background-color: #2563eb; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            <f:ajax execute="@form" render="@form" />
                        </h:commandButton>
                    </div>
                </h:column>

                <h:column>
                    <f:facet name="header">Match score</f:facet>

                    <h:panelGroup rendered="#{not empty a.matchScore}">
                        <h:outputText value="#{a.matchScore}">
                            <f:convertNumber maxFractionDigits="1" minFractionDigits="1" />
                        </h:outputText>
                        %
                    </h:panelGroup>

                    <h:panelGroup rendered="#{empty a.matchScore}">
                        N/A
                    </h:panelGroup>
                </h:column>


                <h:column>
                    <f:facet name="header">Date</f:facet>
                    #{a.dateApplied}
                </h:column>

                <h:column>
                    <f:facet name="header">Action</f:facet>

                    <h:panelGroup rendered="#{applicationBean.selectedStatuses[a.id] eq 'Accepted'}">
                        <div style="display: flex; flex-direction: column; gap: 6px; align-items: flex-start;">
                            <span style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; padding: 4px 12px; border-radius: 999px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 2px 4px rgba(34, 197, 94, 0.3);">
                                ‚úì Accepted
                            </span>
                            <h:link outcome="employerInterviews.xhtml"
                                    styleClass="btn-small"
                                    style="display: inline-flex; align-items: center; gap: 6px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 8px 14px; border-radius: 6px; text-decoration: none; font-size: 12px; font-weight: 600; box-shadow: 0 2px 8px rgba(37, 99, 235, 0.35); transition: all 0.2s ease;">
                                <span style="font-size: 14px;">üìÖ</span> Schedule
                                <f:param name="candidateName" value="#{applicationBean.getApplicantName(a.applicantId)}" />
                                <f:param name="jobId" value="#{a.jobOfferId}" />
                                <f:param name="applicantId" value="#{a.applicantId}" />
                            </h:link>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{applicationBean.selectedStatuses[a.id] eq 'Rejected'}">
                        <span style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; padding: 4px 12px; border-radius: 999px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);">
                            ‚úó Declined
                        </span>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{applicationBean.selectedStatuses[a.id] == null or (applicationBean.selectedStatuses[a.id] ne 'Accepted' and applicationBean.selectedStatuses[a.id] ne 'Rejected')}">
                        <span style="background-color: #f3f4f6; color: #6b7280; padding: 4px 12px; border-radius: 999px; font-size: 11px; font-weight: 500;">
                            ‚è≥ Pending review
                        </span>
                    </h:panelGroup>
                </h:column>

            </h:dataTable>
        </h:form>

    </ui:define>

</ui:composition>
